.check_skip_rust:
  before_script:
    - |-
      if echo "$CI_COMMIT_TITLE" | grep -q "ci-skip-rust"; then
        echo "Skipping rust tests due to commit title"
        exit 0
      fi

cargo-clippy:
  extends: .check_skip_rust
  image: paritytech/ci-unified:bullseye-1.70.0
  variables:
    RUSTDOCFLAGS: '-D warnings'
  stage: check
  cache:
    key: cargo-clippy
    paths:
    - target/
    - $HOME/.cargo/bin/
    - $HOME/.cargo/registry/index/
    - $HOME/.cargo/registry/cache/
    - $HOME/.cargo/git/db/
  script:
    -  SKIP_WASM_BUILD=1 cargo clippy --all-targets --locked --workspace --quiet
    -  SKIP_WASM_BUILD=1 cargo clippy --all-targets --all-features --locked --workspace --quiet
