.check_skip_rust:
  before_script:
    - |-
      if echo "$CI_COMMIT_TITLE" | grep -q "ci-skip-rust"; then
        echo "Skipping rust tests due to commit title"
        exit 0
      fi

cargo-clippy:
  extends: .check_skip_rust
  image: paritytech/ci-unified:bullseye-1.74.0
  variables:
    RUSTDOCFLAGS: '-D warnings'
  stage: check
  cache:
    key: cargo-clippy
    paths:
    - ${CARGO_CACHE_PATH}
  script:
    -  SKIP_WASM_BUILD=1 cargo clippy --all-targets --locked --quiet

cargo-clippy-all-features:
  extends: .check_skip_rust
  image: paritytech/ci-unified:bullseye-1.74.0
  variables:
    RUSTDOCFLAGS: '-D warnings'
  stage: check
  cache:
    key: cargo-clippy-all-features
    paths:
      - ${CARGO_CACHE_PATH}
  script:
    -  SKIP_WASM_BUILD=1 cargo clippy --all-targets --all-features --locked --quiet

check-rustdoc:
  extends: .check_skip_rust
  image: paritytech/ci-unified:bullseye-1.74.0
  variables:
    SKIP_WASM_BUILD: 1
    RUSTDOCFLAGS: '-D warnings'
  stage: check
  cache:
    key: cargo-check-rustdoc
    paths:
      - ${CARGO_CACHE_PATH}
  script:
    - cargo doc --all-features --no-deps --locked
