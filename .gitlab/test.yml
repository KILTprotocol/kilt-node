test:
  extends: .check_skip_rust
  timeout: 2 hours
  image: paritytech/ci-unified:bullseye-1.70.0
  stage: test
  cache:
    key: cargo-test
    paths:
      - target/
      - $HOME/.cargo/bin/
      - $HOME/.cargo/registry/index/
      - $HOME/.cargo/registry/cache/
      - $HOME/.cargo/git/db/
  script:
    - time cargo test --all --all-targets --locked

test-rustdoc:
  extends: .check_skip_rust
  image: paritytech/ci-unified:bullseye-1.70.0
  variables:
    SKIP_WASM_BUILD: 1
  stage: check
  cache:
    key: cargo-test-rustdoc
    paths:
      - target/
      - $HOME/.cargo/bin/
      - $HOME/.cargo/registry/index/
      - $HOME/.cargo/registry/cache/
      - $HOME/.cargo/git/db/
  script:
    - time cargo doc --all-features --no-deps --locked

test-features:
  extends: .check_skip_rust
  timeout: 2 hours
  image: paritytech/ci-unified:bullseye-1.70.0
  stage: test
  cache:
    key: cargo-test-features
    paths:
      - target/
      - $HOME/.cargo/bin/
      - $HOME/.cargo/registry/index/
      - $HOME/.cargo/registry/cache/
      - $HOME/.cargo/git/db/
  script:
    - time cargo test --all --all-features --all-targets --locked
