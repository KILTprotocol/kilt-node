test:
  extends: .check_skip_rust
  timeout: 2 hours
  image: paritytech/ci-unified:bullseye-1.77.0
  stage: test
  cache:
    key: cache-test
    paths:
      - target/
      - .cargo/bin/
      - .cargo/registry/index/
      - .cargo/registry/cache/
      - .cargo/git/db/
  script:
    - time cargo test --all --all-targets --locked

test-features:
  extends: .check_skip_rust
  timeout: 2 hours
  image: paritytech/ci-unified:bullseye-1.77.0
  stage: test
  needs:
    - test
  cache:
    key: cache-test
    paths:
      - target/
      - .cargo/bin/
      - .cargo/registry/index/
      - .cargo/registry/cache/
      - .cargo/git/db/
  script:
    - time cargo test --all --all-features --all-targets --locked
