<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Decentralized Identity Provider (DIP) provider consumer pallet"><title>pallet_dip_consumer - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-fa3bb1812debf86c.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="pallet_dip_consumer" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.0 (79e9716c9 2023-11-13)" data-channel="1.74.0" data-search-js="search-8be46b629f5f14a8.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-c5bd66d33317d69f.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../pallet_dip_consumer/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a></nav><nav class="sidebar"><a class="logo-container" href="../pallet_dip_consumer/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate pallet_dip_consumer</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 1.14.0-dev</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">pallet_dip_consumer</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/pallet_dip_consumer/lib.rs.html#19-202">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="decentralized-identity-provider-dip-provider-consumer-pallet"><a href="#decentralized-identity-provider-dip-provider-consumer-pallet">Decentralized Identity Provider (DIP) provider consumer pallet</a></h2>
<p>This pallet is a component of the DIP protocol.
It enables entities with an identity on a connected Substrate-based chain (provider) to use those identities on the chain this pallet is deployed (consumers) without requiring those entities to set up a new identity locally.</p>
<p>A consumer chain is <em>connected</em> to a provider if there is a way for the consumer chain to verify proofs about parts of the state of the provider chain.</p>
<p>A cross-chain transaction with DIP assumes the entity submitting the transaction has already generated a cross-chain identity commitment on the provider chain, by interacting with the DIP provider pallet on the provider chain.
With a generated identity commitment, a cross-chain transaction flow for a generic entity <code>A</code> works as follows:</p>
<ol>
<li>
<p><code>A</code> generates a state proof proving the state of the identity commitment on the provider chain.</p>
</li>
<li>
<p><code>A</code> generates any additional information required for the consumer runtime to successfully verify an identity proof.</p>
</li>
<li>
<p><code>A</code>, using their account <code>AccC</code> on the consumer chain <code>C</code>, calls the <code>dispatch_as</code> extrinsic by providing its identifier on the provider chain, the generated proof, and the <code>Call</code> to be dispatched on the consumer chain.</p>
<ol>
<li>This pallet verifies if the proof is correct, if not it returns an error.</li>
<li>This pallet dispatches the provided <code>Call</code> with a new origin created by this pallet, returning any errors the dispatch action returns. The origin contains the information revealed in the proof, the identifier of the acting subject and the account <code>AccC</code> dispatching the transaction.</li>
</ol>
</li>
</ol>
<p>The pallet is agnostic over the chain-specific definition of <em>identity proof verifier</em> and <em>identifier</em>, although, when deployed, runtime developers must configure them to respect the definition of identity and identity commitment established by the provider linked to this pallet.</p>
<p>For instance, if the provider establishes that an identity commitment is a Merkle root of a set of public keys, an identity proof for the consumer is most likely a Merkle proof revealing a subset of those keys.
Similarly, if the provider defines an identity commitment as some ZK commitment, the respective identity proof on the consumer chain is a ZK proof verifying the validity of the commitment and the revealed information.</p>
<p>For identifiers, if the provider establishes that an identifier is a public key, the consumer pallet must use the same definition.
Runtime developers must configure other definitions for an identifier, such as a simple integer or a <a href="https://www.w3.org/TR/did-core/">Decentralized Identifier (DID)</a> in the same way.</p>
<p>The pallet allows the consumer runtime to define some <code>LocalIdentityInfo</code> associated with each identifier, which is additional information the pallet’s proof verifier can access and optionally change upon proof verification.
Any changes made to the <code>LocalIdentityInfo</code> is persisted if the identity proof is verified correctly and the extrinsic ran successfully.</p>
<p>If the consumer does not need to store anything in addition to the information an identity proof conveys, they can use an empty tuple <code>()</code> for the local identity info.
Another example could be the use of signatures, which requires a nonce to avoid replay protections.
In this case, use a numeric type such as a <code>u64</code> or a <code>u128</code> and the proof verifier increases it when validating each new cross-chain transaction proof.</p>
<h3 id="add-the-pallet-to-the-runtime"><a href="#add-the-pallet-to-the-runtime">Add the pallet to the runtime</a></h3>
<p>Add the pallet to runtime to the <code>Cargo.toml</code> file dependencies section:</p>
<div class="example-wrap"><pre class="language-toml"><code>consumer = {package = &quot;pallet-dip-consumer&quot;, git = &quot;https://github.com/KILTprotocol/kilt-node.git&quot;, branch = &quot;release-1.12.0&quot;}
</code></pre></div>
<p>The DIP pallet is available in the KILT node release 1.12.0 and later.</p>
<h3 id="the-config-trait"><a href="#the-config-trait">The <code>Config</code> trait</a></h3>
<p>Pass runtime configuration to the pallet’s <code>Config</code> trait.</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>pallet_dip_provider::Config <span class="kw">for </span>Runtime {
    <span class="comment">// Config
</span>}</code></pre></div>
<p>As the runtime is chain-agnostic, the <code>Config</code> trait requires the following configuration parameters passed to it. Most of the types provided must reflect the definition of identity and identity commitment that the identity provider chain has established.</p>
<p>The trait has the following components:</p>
<ul>
<li><code>type DipCallOriginFilter: Contains&lt;RuntimeCallOf&lt;Self&gt;&gt;</code>: A preliminary filter that checks whether a provided <code>Call</code> accepts a DIP origin or not. If a call such as a system call does not accept a DIP origin, there is no need to verify the identity proof, hence the execution can bail out early. This does not guarantee that the dispatch call succeeds, but likely not fail with a <code>BadOrigin</code> error.</li>
<li><code>type DispatchOriginCheck: EnsureOrigin&lt;&lt;Self as frame_system::Config&gt;::RuntimeOrigin, Success = Self::AccountId&gt;</code>: The origin check on the <code>dispatch_as</code> extrinsic to verify that the caller is authorized to call the extrinsic. If successful, the check must return an <code>AccountId</code> as defined by the consumer runtime.</li>
<li><code>type Identifier: Parameter + MaxEncodedLen</code>: The subject identifier type. This must match the definition of <code>Identifier</code> the identity provider has defined in their deployment of the provider pallet.</li>
<li><code>type LocalIdentityInfo: FullCodec + TypeInfo + MaxEncodedLen</code>: Any additional information that must be available only to the provider runtime required to provide context when verifying a cross-chain identity proof.</li>
<li><code>type ProofVerifier: IdentityProofVerifier&lt;Self&gt;</code>: The core component of this pallet that takes care of validating an identity proof and optionally updates any <code>LocalIdentityInfo</code>. It also defines, via its associated type, the structure of the identity proof that must be passed to the <code>dispatch_as</code> extrinsic. Although not directly, the proof structure depends on the information that goes into the identity commitment on the provider chain, as that defines what information can be revealed as part of the commitment proof. Additional info to satisfy requirements according to the <code>LocalIdentityInfo</code> (e.g., a signature) must also be provided in the proof.</li>
<li><code>type RuntimeCall: Parameter + Dispatchable&lt;RuntimeOrigin = &lt;Self as Config&gt;::RuntimeOrigin&gt;</code>: The aggregated <code>Call</code> type.</li>
<li><code>type RuntimeOrigin: From&lt;Origin&lt;Self&gt;&gt; + From&lt;&lt;Self as frame_system::Config&gt;::RuntimeOrigin&gt;</code>: The aggregated <code>Origin</code> type, which must include the origin exposed by this pallet.</li>
</ul>
<h3 id="storage"><a href="#storage">Storage</a></h3>
<p>The pallet contains a single storage element, the <code>IdentityEntries</code> map. It maps from a subject <code>Identifier</code> to an instance of <code>LocalIdentityInfo</code>.</p>
<p>The proof verifier updates this information whenever a new cross-chain transaction and its proof is submitted.</p>
<h3 id="origin"><a href="#origin">Origin</a></h3>
<p>Because the pallet allows the dispatching of other <code>Call</code>s after an identity proof has been verified, it also exposes an <code>Origin</code> to calls that need to be DIP-authorized.</p>
<p>After the proof verifier has successfully verified the identity proof, the origin is created, and it includes the identifier of the subject, the address of the tx submitter, and the result returned by the proof verifier upon successful verification.</p>
<h3 id="calls"><a href="#calls">Calls</a></h3>
<p>Bullet points represent each call’s encoded index</p>
<ol start="0">
<li><code>pub fn dispatch_as(origin: OriginFor&lt;T&gt;, identifier: T::Identifier, proof: IdentityProofOf&lt;T&gt;, call: Box&lt;RuntimeCallOf&lt;T&gt;&gt;) -&gt; DispatchResult</code>: Try to dispatch a new local call only if it passes all the DIP requirements. Specifically, the call is dispatched if it passes the preliminary <code>DipCallOriginFilter</code> and if the proof verifier returns an <code>Ok(verification_result)</code> value. The value is then added to the <code>DipOrigin</code> and passed down as the origin for the specified <code>Call</code>. If the whole execution terminates successfully, any changes applied to the <code>LocalIdentityInfo</code> by the proof verifier are persisted to the pallet storage.</li>
</ol>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.SuccessfulProofVerifier"><code>pub use crate::traits::<a class="struct" href="traits/struct.SuccessfulProofVerifier.html" title="struct pallet_dip_consumer::traits::SuccessfulProofVerifier">SuccessfulProofVerifier</a>;</code></div></li><li><div class="item-name"><code>pub use crate::<a class="mod" href="pallet/index.html" title="mod pallet_dip_consumer::pallet">pallet</a>::*;</code></div></li></ul><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="benchmarking/index.html" title="mod pallet_dip_consumer::benchmarking">benchmarking</a></div></li><li><div class="item-name"><a class="mod" href="pallet/index.html" title="mod pallet_dip_consumer::pallet">pallet</a></div><div class="desc docblock-short">The <code>pallet</code> module in each FRAME pallet hosts the most important items needed
to construct this pallet.</div></li><li><div class="item-name"><a class="mod" href="traits/index.html" title="mod pallet_dip_consumer::traits">traits</a></div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.DipOrigin.html" title="struct pallet_dip_consumer::DipOrigin">DipOrigin</a></div><div class="desc docblock-short">An origin passed down to the to-be-dispatched <code>Call</code> upon successful DIP
proof verification.</div></li><li><div class="item-name"><a class="struct" href="struct.EnsureDipOrigin.html" title="struct pallet_dip_consumer::EnsureDipOrigin">EnsureDipOrigin</a></div><div class="desc docblock-short">Implementation of the <code>EnsureOrigin</code> trait verifying that a given origin is
a <code>DipOrigin</code>.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.WeightInfo.html" title="trait pallet_dip_consumer::WeightInfo">WeightInfo</a></div><div class="desc docblock-short">Weight functions needed for pallet_dip_consumer.</div></li></ul></section></div></main></body></html>