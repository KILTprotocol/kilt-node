<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `crates/kilt-dip-primitives/src/state_proofs/mod.rs`."><title>mod.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-fa3bb1812debf86c.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="kilt_dip_primitives" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.0 (79e9716c9 2023-11-13)" data-channel="1.74.0" data-search-js="search-8be46b629f5f14a8.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../../../static.files/src-script-3280b574d94e47b4.js"></script><script defer src="../../../src-files.js"></script><script defer src="../../../static.files/main-c5bd66d33317d69f.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc src"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"></nav><main><nav class="sub"><a class="sub-logo-container" href="../../../kilt_dip_primitives/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="example-wrap"><div data-nosnippet><pre class="src-line-numbers"><a href="#1" id="1">1</a>
<a href="#2" id="2">2</a>
<a href="#3" id="3">3</a>
<a href="#4" id="4">4</a>
<a href="#5" id="5">5</a>
<a href="#6" id="6">6</a>
<a href="#7" id="7">7</a>
<a href="#8" id="8">8</a>
<a href="#9" id="9">9</a>
<a href="#10" id="10">10</a>
<a href="#11" id="11">11</a>
<a href="#12" id="12">12</a>
<a href="#13" id="13">13</a>
<a href="#14" id="14">14</a>
<a href="#15" id="15">15</a>
<a href="#16" id="16">16</a>
<a href="#17" id="17">17</a>
<a href="#18" id="18">18</a>
<a href="#19" id="19">19</a>
<a href="#20" id="20">20</a>
<a href="#21" id="21">21</a>
<a href="#22" id="22">22</a>
<a href="#23" id="23">23</a>
<a href="#24" id="24">24</a>
<a href="#25" id="25">25</a>
<a href="#26" id="26">26</a>
<a href="#27" id="27">27</a>
<a href="#28" id="28">28</a>
<a href="#29" id="29">29</a>
<a href="#30" id="30">30</a>
<a href="#31" id="31">31</a>
<a href="#32" id="32">32</a>
<a href="#33" id="33">33</a>
<a href="#34" id="34">34</a>
<a href="#35" id="35">35</a>
<a href="#36" id="36">36</a>
<a href="#37" id="37">37</a>
<a href="#38" id="38">38</a>
<a href="#39" id="39">39</a>
<a href="#40" id="40">40</a>
<a href="#41" id="41">41</a>
<a href="#42" id="42">42</a>
<a href="#43" id="43">43</a>
<a href="#44" id="44">44</a>
<a href="#45" id="45">45</a>
<a href="#46" id="46">46</a>
<a href="#47" id="47">47</a>
<a href="#48" id="48">48</a>
<a href="#49" id="49">49</a>
<a href="#50" id="50">50</a>
<a href="#51" id="51">51</a>
<a href="#52" id="52">52</a>
<a href="#53" id="53">53</a>
<a href="#54" id="54">54</a>
<a href="#55" id="55">55</a>
<a href="#56" id="56">56</a>
<a href="#57" id="57">57</a>
<a href="#58" id="58">58</a>
<a href="#59" id="59">59</a>
<a href="#60" id="60">60</a>
<a href="#61" id="61">61</a>
<a href="#62" id="62">62</a>
<a href="#63" id="63">63</a>
<a href="#64" id="64">64</a>
<a href="#65" id="65">65</a>
<a href="#66" id="66">66</a>
<a href="#67" id="67">67</a>
<a href="#68" id="68">68</a>
<a href="#69" id="69">69</a>
<a href="#70" id="70">70</a>
<a href="#71" id="71">71</a>
<a href="#72" id="72">72</a>
<a href="#73" id="73">73</a>
<a href="#74" id="74">74</a>
<a href="#75" id="75">75</a>
<a href="#76" id="76">76</a>
<a href="#77" id="77">77</a>
<a href="#78" id="78">78</a>
<a href="#79" id="79">79</a>
<a href="#80" id="80">80</a>
<a href="#81" id="81">81</a>
<a href="#82" id="82">82</a>
<a href="#83" id="83">83</a>
<a href="#84" id="84">84</a>
<a href="#85" id="85">85</a>
<a href="#86" id="86">86</a>
<a href="#87" id="87">87</a>
<a href="#88" id="88">88</a>
<a href="#89" id="89">89</a>
<a href="#90" id="90">90</a>
<a href="#91" id="91">91</a>
<a href="#92" id="92">92</a>
<a href="#93" id="93">93</a>
<a href="#94" id="94">94</a>
<a href="#95" id="95">95</a>
<a href="#96" id="96">96</a>
<a href="#97" id="97">97</a>
<a href="#98" id="98">98</a>
<a href="#99" id="99">99</a>
<a href="#100" id="100">100</a>
<a href="#101" id="101">101</a>
<a href="#102" id="102">102</a>
<a href="#103" id="103">103</a>
<a href="#104" id="104">104</a>
<a href="#105" id="105">105</a>
<a href="#106" id="106">106</a>
<a href="#107" id="107">107</a>
<a href="#108" id="108">108</a>
<a href="#109" id="109">109</a>
<a href="#110" id="110">110</a>
<a href="#111" id="111">111</a>
<a href="#112" id="112">112</a>
<a href="#113" id="113">113</a>
<a href="#114" id="114">114</a>
<a href="#115" id="115">115</a>
<a href="#116" id="116">116</a>
<a href="#117" id="117">117</a>
<a href="#118" id="118">118</a>
<a href="#119" id="119">119</a>
<a href="#120" id="120">120</a>
<a href="#121" id="121">121</a>
<a href="#122" id="122">122</a>
<a href="#123" id="123">123</a>
<a href="#124" id="124">124</a>
<a href="#125" id="125">125</a>
<a href="#126" id="126">126</a>
<a href="#127" id="127">127</a>
<a href="#128" id="128">128</a>
<a href="#129" id="129">129</a>
<a href="#130" id="130">130</a>
<a href="#131" id="131">131</a>
<a href="#132" id="132">132</a>
<a href="#133" id="133">133</a>
<a href="#134" id="134">134</a>
<a href="#135" id="135">135</a>
<a href="#136" id="136">136</a>
<a href="#137" id="137">137</a>
<a href="#138" id="138">138</a>
<a href="#139" id="139">139</a>
<a href="#140" id="140">140</a>
<a href="#141" id="141">141</a>
<a href="#142" id="142">142</a>
<a href="#143" id="143">143</a>
<a href="#144" id="144">144</a>
<a href="#145" id="145">145</a>
<a href="#146" id="146">146</a>
<a href="#147" id="147">147</a>
<a href="#148" id="148">148</a>
<a href="#149" id="149">149</a>
<a href="#150" id="150">150</a>
<a href="#151" id="151">151</a>
<a href="#152" id="152">152</a>
<a href="#153" id="153">153</a>
<a href="#154" id="154">154</a>
<a href="#155" id="155">155</a>
<a href="#156" id="156">156</a>
<a href="#157" id="157">157</a>
<a href="#158" id="158">158</a>
<a href="#159" id="159">159</a>
<a href="#160" id="160">160</a>
<a href="#161" id="161">161</a>
<a href="#162" id="162">162</a>
<a href="#163" id="163">163</a>
<a href="#164" id="164">164</a>
<a href="#165" id="165">165</a>
<a href="#166" id="166">166</a>
<a href="#167" id="167">167</a>
<a href="#168" id="168">168</a>
<a href="#169" id="169">169</a>
<a href="#170" id="170">170</a>
<a href="#171" id="171">171</a>
<a href="#172" id="172">172</a>
<a href="#173" id="173">173</a>
<a href="#174" id="174">174</a>
<a href="#175" id="175">175</a>
<a href="#176" id="176">176</a>
<a href="#177" id="177">177</a>
<a href="#178" id="178">178</a>
<a href="#179" id="179">179</a>
<a href="#180" id="180">180</a>
<a href="#181" id="181">181</a>
</pre></div><pre class="rust"><code><span class="comment">// KILT Blockchain – https://botlabs.org
// Copyright (C) 2019-2024 BOTLabs GmbH

// The KILT Blockchain is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.

// The KILT Blockchain is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.

// You should have received a copy of the GNU General Public License
// along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.

// If you feel like getting in touch with us, you can do so at info@botlabs.org

</span><span class="kw">use </span>parity_scale_codec::Decode;
<span class="kw">use </span>sp_runtime::traits::Hash;
<span class="kw">use </span>sp_std::vec::Vec;
<span class="kw">use </span>sp_trie::StorageProof;

<span class="kw">use crate</span>::{state_proofs::substrate_no_std_port::read_proof_check, utils::OutputOf};

<span class="comment">// Ported and adapted from &lt;https://github.com/paritytech/substrate/blob/polkadot-v1.0.0/primitives/state-machine/src/lib.rs&gt;.
// Refer to the original source file for full license details.
// Needs to be replaced with its runtime-friendly version when available, or be
// kept up-to-date with upstream.
</span><span class="kw">mod </span>substrate_no_std_port;

<span class="kw">mod </span>error;
<span class="kw">pub use </span>error::<span class="kw-2">*</span>;

<span class="doccomment">/// Verify a Merkle-based storage proof for a given storage key according to the
/// provided state root. The generic types indicate the following:
/// * `StorageKey`: defines the type of the storage key included in the proof.
/// * `MerkleHasher`: defines the hashing algorithm used to calculate the Merkle
///   root.
/// * `Success`: defines the type expected to be revealed in a valid Merkle
///   proof.
</span><span class="kw">pub fn </span>verify_storage_value_proof&lt;StorageKey, MerkleHasher, Success&gt;(
	storage_key: <span class="kw-2">&amp;</span>StorageKey,
	state_root: OutputOf&lt;MerkleHasher&gt;,
	state_proof: <span class="kw">impl </span>IntoIterator&lt;Item = Vec&lt;u8&gt;&gt;,
) -&gt; <span class="prelude-ty">Result</span>&lt;Success, MerkleProofError&gt;
<span class="kw">where
	</span>StorageKey: AsRef&lt;[u8]&gt;,
	MerkleHasher: Hash,
	OutputOf&lt;MerkleHasher&gt;: Ord,
	Success: Decode,
{
	verify_storage_value_proof_with_decoder::&lt;<span class="kw">_</span>, MerkleHasher, <span class="kw">_</span>&gt;(storage_key, state_root, state_proof, |input| {
		Success::decode(input).ok()
	})
}

<span class="doccomment">/// Verify a Merkle-based storage proof for a given storage key according to the
/// provided state root. The generic types indicate the following:
/// * `StorageKey`: defines the type of the storage key included in the proof.
/// * `MerkleHasher`: defines the hashing algorithm used to calculate the Merkle
///   root.
/// * `TransformResult`: the type returned by the provided decoding function, if
///   successful. The `None` result is interpreted as an error, so it is not possible to return a type for which `None` would be a correct decoding, for now. See &lt;https://github.com/rust-lang/rust/issues/103765&gt; for more details.
</span><span class="kw">pub fn </span>verify_storage_value_proof_with_decoder&lt;StorageKey, MerkleHasher, TransformResult&gt;(
	storage_key: <span class="kw-2">&amp;</span>StorageKey,
	state_root: OutputOf&lt;MerkleHasher&gt;,
	state_proof: <span class="kw">impl </span>IntoIterator&lt;Item = Vec&lt;u8&gt;&gt;,
	<span class="comment">// TODO: Switch to `Error` from `Option` for the closure.
	// `Error` is not yet available in core.
	// It was merged recently and will be stabilized at some point. See https://github.com/rust-lang/rust/issues/103765 for more.
	</span><span class="kw-2">mut </span>transform: <span class="kw">impl </span>FnMut(<span class="kw-2">&amp;mut &amp;</span>[u8]) -&gt; <span class="prelude-ty">Option</span>&lt;TransformResult&gt;,
) -&gt; <span class="prelude-ty">Result</span>&lt;TransformResult, MerkleProofError&gt;
<span class="kw">where
	</span>StorageKey: AsRef&lt;[u8]&gt;,
	MerkleHasher: Hash,
	OutputOf&lt;MerkleHasher&gt;: Ord,
{
	<span class="kw">const </span>LOG_TARGET: <span class="kw-2">&amp;</span>str = <span class="string">&quot;dip::consumer::verify_storage_value_proof_with_decoder&quot;</span>;
	<span class="kw">let </span>storage_proof = StorageProof::new(state_proof);
	<span class="kw">let </span><span class="kw-2">mut </span>revealed_leaves = read_proof_check::&lt;MerkleHasher, <span class="kw">_</span>&gt;(state_root, storage_proof, [storage_key].iter())
		.map_err(|e| {
			<span class="macro">log::info!</span>(
				target: LOG_TARGET,
				<span class="string">&quot;Failed verification of storage proof with error {:#?}&quot;</span>,
				e
			);
			MerkleProofError::InvalidProof
		})<span class="question-mark">?</span>;

	<span class="macro">debug_assert!</span>(
		revealed_leaves.len() == <span class="number">1usize</span>,
		<span class="string">&quot;Only a single leaf is expected to be revealed in the storage proof.&quot;
	</span>);
	<span class="macro">debug_assert!</span>(
		revealed_leaves.contains_key(storage_key.as_ref()),
		<span class="string">&quot;Proof does not include the expected storage key.&quot;
	</span>);

	<span class="kw">let </span><span class="prelude-val">Some</span>(<span class="prelude-val">Some</span>(encoded_revealed_leaf)) = revealed_leaves.get_mut(storage_key.as_ref()) <span class="kw">else </span>{
		<span class="kw">return </span><span class="prelude-val">Err</span>(MerkleProofError::RequiredLeafNotRevealed);
	};

	<span class="kw">let </span>input = <span class="kw-2">&amp;mut &amp;</span>encoded_revealed_leaf[..];
	transform(input).ok_or(MerkleProofError::ResultDecoding)
}

<span class="attr">#[cfg(test)]
</span><span class="kw">mod </span>test {
	<span class="kw">use </span>cumulus_primitives_core::relay_chain::HeadData;
	<span class="kw">use </span>hex_literal::hex;
	<span class="kw">use </span>parity_scale_codec::Encode;
	<span class="kw">use </span>sp_core::{storage::StorageKey, H256};
	<span class="kw">use </span>sp_runtime::traits::BlakeTwo256;

	<span class="kw">use </span><span class="kw">crate</span>::state_proofs::verify_storage_value_proof;

	<span class="attr">#[test]
	</span><span class="kw">fn </span>verify_storage_value_proof_spiritnet_system_event_count() {
		<span class="comment">// As of RPC state_getReadProof(&quot;
		// 0x26aa394eea5630e07c48ae0c9558cef70a98fdbe9ce6c55837576c60c7af3850&quot;,
		// &quot;0x2c0746e7e9ccc6e4d27bcb4118cb6821ae53ae9bf372f4f49ac28d8598f9bed5&quot;)
		</span><span class="kw">let </span>events_count_storage_key =
			StorageKey(frame_support::storage::storage_prefix(<span class="string">b&quot;System&quot;</span>, <span class="string">b&quot;EventCount&quot;</span>).to_vec());
		<span class="kw">let </span>spiritnet_event_count_proof_at_block = [
			<span class="macro">hex!</span>(<span class="string">&quot;800404645ea5c1b19ab7a04f536c519aca4983ac205cda3f0000000000545e98fdbe9ce6c55837576c60c7af38501005000000&quot;</span>).to_vec(),
			<span class="macro">hex!</span>(<span class="string">&quot;80401080481e2bd8085a02c5b58987bce7a69f0b5c7fa651e8e82c5481c94707860be9078067785103d453293707ba847e21df7e35a7a57b8fb929d40465328b6642669fcc&quot;</span>).to_vec(),
			<span class="macro">hex!</span>(<span class="string">&quot;80ffff8010623b5a3a9dbc752963d827be0bb855bf3e24258ae09341d5f762e96a836ac180c34b753605e821528756b55b4ddafb742df6e54fbc03ef401d4ebfd6dd4f3e44806f83646e0bf3ca0ac9f2092dea5b0e3caf210cc6b54c3b44a51855a133367a6580b02cde7b1fd3f8d13f698ef6e9daa29b32258d4d97a8947051070a4540aecacd80903d521961849d07ceee132617b8dde96c3ff472f5a9a089d4055ffe7ffd1e988016c29c943c106713bb8f16b776eb7daed005540165696da286cddf6b25d085448019a464010cb746b0589891f72b0eed603d4712b04af46f7bcae724564194801480a305ffe069db7eb21841f75b5939943f62c4abb3a051d530839c5dd935ccbc8a8035d8938b0c856878de1e3fe45a559588b2da52ccf195ab1e3d0aca6ac7bb079d8064019a474a283c19f46ff4652a5e1f636efd4013d3b8a91c49573045c6ff01c0801a191dcb736faddb84889a13c7aa717d260e9b635b30a9eb3907f925a2253d6880f8bc389fc62ca951609bae208b7506bae497623e647424062d1c56cb1f2d2e1c80211a9fb5f8b794f9fbfbdcd4519aa475ecaf9737b4ee513dde275d5fbbe64da080c267d0ead99634e9b9cfbf61a583877e0241ac518e62e909fbb017469de275f780b3059a7226d4b320c25e9b2f8ffe19cf93467e3b306885962c5f34b5671d15fe8092dfba9e30e1bbefab13c792755d06927e6141f7220b7485e5aa40de92401a66&quot;</span>).to_vec(),
			<span class="macro">hex!</span>(<span class="string">&quot;9eaa394eea5630e07c48ae0c9558cef7398f8069ef420a0deb5a428c9a08563b28a78874bba09124eecc8d28bf30b0e2ddd310745f04abf5cb34d6244378cddbf18e849d962c000000000736d8e8140100505f0e7b9012096b41c4eb3aaf947f6ea4290800004c5f0684a022a34dd8bfa2baaf44f172b710040180dd3270a03a1a13fc20bcdf24d1aa4ddccc6183db2e2e153b8a68ba8540699a8a80b413dad63538a591f7f2575d287520ee44d7143aa5ec2411969861e1f55a2989804c3f0f541a13980689894db7c60c785dd29e066f213bb29b17aa740682ad7efd8026d3a50544f5c89500745aca2be36cfe076f599c5115192fb9deae227e2710c980bd04b00bf6b42756a06a4fbf05a5231c2094e48182eca95d2cff73ab907592aa&quot;</span>).to_vec(),
			].to_vec();
		<span class="kw">let </span>spiritnet_state_root: H256 =
			<span class="macro">hex!</span>(<span class="string">&quot;94c23fda279cea4a4370e90f1544c8938923dfd4ac201a420c7a26fb0d3caf8c&quot;</span>).into();
		<span class="comment">// As of query system::eventCount() at block
		// &quot;0x2c0746e7e9ccc6e4d27bcb4118cb6821ae53ae9bf372f4f49ac28d8598f9bed5&quot; which
		// results in the key
		// &quot;0x26aa394eea5630e07c48ae0c9558cef70a98fdbe9ce6c55837576c60c7af3850&quot;
		</span><span class="kw">let </span>expected_event_count_at_block = <span class="number">5u32</span>;
		<span class="kw">let </span>event_count_at_block = verify_storage_value_proof::&lt;<span class="kw">_</span>, BlakeTwo256, u32&gt;(
			<span class="kw-2">&amp;</span>events_count_storage_key,
			spiritnet_state_root,
			spiritnet_event_count_proof_at_block,
		)
		.expect(<span class="string">&quot;Merkle proof verification for pre-calculated Spiritnet storage entry should not fail.&quot;</span>);
		<span class="macro">assert_eq!</span>(expected_event_count_at_block, event_count_at_block);
	}

	<span class="attr">#[test]
	</span><span class="kw">fn </span>verify_storage_value_proof_polkadot_parahead_proof_for_spiritnet() {
		<span class="comment">// As of RPC state_getReadProof(&quot;0xcd710b30bd2eab0352ddcc26417aa1941b3c252fcb29d88eff4f3de5de4476c32c0cfd6c23b92a7826080000&quot;, &quot;0x18e90e9aa8e3b063f60386ba1b0415111798e72d01de58b1438d620d42f58e39&quot;)
		</span><span class="kw">let </span>spiritnet_head_storage_key = StorageKey(
			[
				frame_support::storage::storage_prefix(<span class="string">b&quot;Paras&quot;</span>, <span class="string">b&quot;Heads&quot;</span>).as_slice(),
				sp_io::hashing::twox_64(<span class="number">2_086u32</span>.encode().as_ref()).as_slice(),
				<span class="number">2_086u32</span>.encode().as_slice(),
			]
			.concat(),
		);
		<span class="kw">let </span>spiritnet_head_proof_at_block = [
			<span class="macro">hex!</span>(<span class="string">&quot;570c0cfd6c23b92a7826080000f102e90265541097fb02782e14f43074f0b00e44ae8e9fe426982323ef1d329739740d37f252ff006d1156941db1bccd58ce3a1cac4f40cad91f692d94e98f501dd70081a129b69a3e2ef7e1ff84ba3d86dab4e95f2c87f6b1055ebd48519c185360eae58f05d1ea08066175726120dcdc6308000000000561757261010170ccfaf3756d1a8dd8ae5c89094199d6d32e5dd9f0920f6fe30f986815b5e701974ea0e0e0a901401f2c72e3dd8dbdf4aa55d59bf3e7021856cdb8038419eb8c&quot;</span>).to_vec(),
			<span class="macro">hex!</span>(<span class="string">&quot;80046480186b1513c5112466ada33da3c65558979906ca9fb82510b62f6ea01f550a4807808bc90ded5636f31c8395a315b5f27a1a25a2ceebd36921a518669ce7e52f80e680993c5e952e6e4f72f295ba04951ace9029b23e9a87887b41895c16f77bec42ee80b798b224c5ee3d668519e75ca98504116f645fb969a5e2653a298b0181f9a694&quot;</span>).to_vec(),
			<span class="macro">hex!</span>(<span class="string">&quot;80ffff806ecd86e87715a007ee9b216d8a99a604773014260d51f6552b6fbd7c21786d9c80e23ef51809d6c80c01a6e264ff0d298cce01c1addfdbb0789597b9a6b3f3e4fd80c9c5f0f29d777e2cebcdbd06ddf1c2cfa8ee83524b37ace99d8b7a3aeff039b380da013185503cfefa6c9cc88751993f1f2bf4b8fa4918e876f499fb9405e3206c803a89668f636552a0fb93619913dcc46cf3e087363d532b76a345155a44a46b5180c2e7fc654720b7dcc0316ae1591fde4beb8b853a343b7e5e3ee564d2692c2ee280840f9c4ae7c16ae948828bf50faf062264402e6134d2d6144a5e3ecb0a1e1d9c80f93c2be1ef51fb2032445cc7fbc2023b9e3b8cf8c0d832b464ae48a020bfaa8c8010c63537c9bf58d50c8c0e13c154fd88b2f683e13701901bdc64565aa9b756d580f0b60eaf17fb680827e8a8938c717ac943b85ff373c0fc911e06c34a3a30327280ccb29f1efa59fd7c80a730cb88789a5a256b01fee7e83ac9a3c90da330adc7a480c8e57c547edb33d4b712f017f09d2de2e055f18815669c83eef2f7f3e5dcafae80b7b7e7ffc91a7dd4c4902f7f15cd7598d1258a75433ea953565661d114e2dcca80ebc3a2df819c7c2fd1a33eb1d484beaf7b71114d6a6db240d8b07dc10bfdc49b80a71f21aa3fa5d7475bf134d50f25e2515c797d0a4c2e93998888150c1f969ab8801e32613f54e70c95e9b16a14f5797522ef5e2ef7867868ff663e33e8880994ed&quot;</span>).to_vec(),
			<span class="macro">hex!</span>(<span class="string">&quot;9e710b30bd2eab0352ddcc26417aa1945fd380d49ebc7ca5c1b751c2badb5e5a326d3ba9e331d8b7c6cf279ed7fd71a8882b6c8038088652f73dc8a22336d10f492f0ef8836beaba0ccfeb0f8fabdc9df1d17e2d807f88402cbbed7fa3307e07044200b572d5e8e12913b41e1923dcb2c0799bc2be804d57e9a8e4934fab698a9db50682052ee9459c666a075d1bfc471da8e5da14da80b9aee043e378f8313e68a6030679ccf3880fa1e7ab19b6244b5c262b7a152f004c5f03c716fb8fff3de61a883bb76adb34a2040080f282bc12648ffb197ffc257edc7ff3a3fdda452daa51091ccbd2dfb91d8aa9518008a0c609ab4888f02c2545c002153297c2641c5a7b4f3d8e25c634e721f80bea80b6617c764df278313c426c46961ccde8ee7a03f9007b74bc8bc6c49d1583cf7d8077b493d45eb153353026cc330307e0753ac41a5cb8e843ceb1efdc46655f33a0808bdaa43fc5dc0e928e2da0ce8ed02096b0b74c61feaba2546980ed9c6174f71d&quot;</span>).to_vec(),
			<span class="macro">hex!</span>(<span class="string">&quot;9f0b3c252fcb29d88eff4f3de5de4476c3ffbf8013c601cc93de3437f9d415bd52c48d794b341f218b9d0020a4b646746c24d0ca80348b8e2c39c479a146933297f62b7051df82e92e1bca761432c3e6f64c74033f80220131e7cd7a08b97f8aa06225f7aefbbca8118fb436c07689c552ed3f577145806d974dd9e4db5e407e29f84c4121ccc58f9c6adc3933afc1bcaef52defe77de5801e9e1a21db053de56365fdee57998488ddae7d664c0430da90469dde17936c1f80c5c11751bbfc99a1ad805c58a65b9704e0bad58e694023e9cc57ce6ef84cdb0b8038f6c242700eaea04ffad5c25ca9a9b1cc2af7303655a32eb59e84b6bb927cd3802575469e76e104b0db8b18dbc762b997a78aa666432a44c4b955ced044a4691f80a81408b856272feeec08845af515e27d033efd3ff8b46de6bc706c38e600086a809ee78332c2a38a3918070942421e651e0b9a43e4b8b2c92e87a2552cede73e8380c9d79f411f742cad0c6f2b070aa08703a04cb7db840c3821a6762837dd8d00e9807dcfbc7f2fcc9415e2cb40eef7f718758d76193f325b3f8b7180e3e5e7d6b81e8036252cae6d24a531a151ce1ee223a07bf71cf82a7fdf49090e4ca345d27d68ca80e3f08ef11671f8f1defa66fa2af71e1a871430e9352df9b3f1d427b5a5dabfb280b51d28c9b99030d050fc1578cd23b5506e769b86c8f4ccc6aded4b8d7c1a73b7&quot;</span>).to_vec(),
		].to_vec();
		<span class="kw">let </span>polkadot_state_root: H256 = <span class="macro">hex!</span>(<span class="string">&quot;81b75d95075d16005ee0a987a3f061d3011ada919b261e9b02961b9b3725f3fd&quot;</span>).into();
		<span class="comment">// As of query paras::heads(2_086) at block
		// &quot;0x18e90e9aa8e3b063f60386ba1b0415111798e72d01de58b1438d620d42f58e39&quot;
		// (16_363_919) which results in the key
		// &quot;0xcd710b30bd2eab0352ddcc26417aa1941b3c252fcb29d88eff4f3de5de4476c32c0cfd6c23b92a7826080000&quot;
		</span><span class="kw">let </span>expected_spiritnet_head_at_block = <span class="macro">hex!</span>(<span class="string">&quot;65541097fb02782e14f43074f0b00e44ae8e9fe426982323ef1d329739740d37f252ff006d1156941db1bccd58ce3a1cac4f40cad91f692d94e98f501dd70081a129b69a3e2ef7e1ff84ba3d86dab4e95f2c87f6b1055ebd48519c185360eae58f05d1ea08066175726120dcdc6308000000000561757261010170ccfaf3756d1a8dd8ae5c89094199d6d32e5dd9f0920f6fe30f986815b5e701974ea0e0e0a901401f2c72e3dd8dbdf4aa55d59bf3e7021856cdb8038419eb8c&quot;</span>).to_vec();
		<span class="kw">let </span>spiritnet_head_at_block = verify_storage_value_proof::&lt;<span class="kw">_</span>, BlakeTwo256, HeadData&gt;(
			<span class="kw-2">&amp;</span>spiritnet_head_storage_key,
			polkadot_state_root,
			spiritnet_head_proof_at_block,
		)
		.expect(
			<span class="string">&quot;Merkle proof verification for pre-calculated Polkadot storage entry for Spiritnet head should not fail.&quot;</span>,
		);
		<span class="macro">assert_eq!</span>(expected_spiritnet_head_at_block, spiritnet_head_at_block.<span class="number">0</span>);
	}
}
</code></pre></div></section></main></body></html>